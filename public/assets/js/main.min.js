$(async function(){$(window).on("resize.vh",function(){var e=.01*window.innerHeight;$("html").css("--vh",e+"px")}).trigger("resize.vh");const a=document.querySelector("[data-camera-video]"),w=document.querySelector("[data-camera-canvas]"),l=w.getContext("2d");let t,e=!0,i;function n(){navigator.mediaDevices.getUserMedia({video:{facingMode:e?"user":"environment",width:{ideal:2400},height:{ideal:3200}}}).then(function(e){t=e,a.srcObject=e}).catch(function(e){alert("取得相機訪問權限失敗: ",e.message,e.name)})}n();new Promise((e,t)=>{a.addEventListener("loadeddata",function(){w.width=a.videoWidth,w.height=a.videoHeight,e()},!1)});await 0,$("[data-camera-direction]").on("click",function(){t.getTracks().forEach(e=>e.stop()),i.stop(),e=!e,n(),i=new Camera(a,{onFrame:async()=>{await o.send({image:a})},width:a.videoWidth,height:a.videoHeight,facingMode:e?"user":"environment"}),i.start()});const v=new Image;v.src="./assets/image/touch/logo.png";const o=new FaceMesh({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${e}`});o.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),o.onResults(function(g){requestAnimationFrame(()=>{if(l.clearRect(0,0,w.width,w.height),l.save(),e&&(l.translate(w.width,0),l.scale(-1,1)),l.drawImage(g.image,0,0,w.width,w.height),g.multiFaceLandmarks&&0<g.multiFaceLandmarks.length){var n=g.multiFaceLandmarks[0];let e=1/0,t=1/0,a=-1/0,i=-1/0;for(const m of n){var o=m.x*w.width,d=m.y*w.height;e=Math.min(e,o),t=Math.min(t,d),a=Math.max(a,o),i=Math.max(i,d)}var r=a-e,c=r*(i-t)/(window.innerWidth*window.innerHeight),s=n[10],h=s.x*w.width,s=s.y*w.height,c=r+10*c;l.drawImage(v,h-c/2,s-c,c,c);c=n[13],n=n[14];.05<Math.abs(c.y-n.y)&&console.log("Mouth opened")}l.restore()})}),i=new Camera(a,{onFrame:async()=>{await o.send({image:a})},width:a.videoWidth,height:a.videoHeight,facingMode:e?"user":"environment"}),i.start()});