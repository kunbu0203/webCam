$(function(){$(window).on("resize.vh",function(){var e=.01*window.innerHeight;$("html").css("--vh",e+"px")}).trigger("resize.vh");const f=new Image;f.src="./assets/image/touch/logo.png";const p=new Image;p.src="./assets/image/food.svg";let y=0,n,d,e=!0,o=!1,r=!1,x=!1,C=-100,M=-500,F=0;const c=new FaceMesh({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${e}`});function t(t){const a=document.createElement("video");a.setAttribute("playsinline",""),a.setAttribute("autoplay",""),a.setAttribute("muted",""),document.querySelector(".camera-video").appendChild(a);const w=document.createElement("canvas");document.querySelector(".camera-screen").appendChild(w);const v=w.getContext("2d");let i;navigator.mediaDevices.getUserMedia({video:{facingMode:t,width:{ideal:2400},height:{ideal:3200}}}).then(async function(e){n=e,a.srcObject=e,i&&a.removeEventListener("loadeddata",i);new Promise((e,t)=>{i=function(){w.width=a.videoWidth,w.height=a.videoHeight,y=.2*w.width,e()},a.addEventListener("loadeddata",i,!1)});await 0,c.onResults(function(u){requestAnimationFrame(()=>{if(v.clearRect(0,0,w.width,w.height),v.save(),"user"===t&&(v.translate(w.width,0),v.scale(-1,1)),v.drawImage(u.image,0,0,w.width,w.height),u.multiFaceLandmarks)for(const e of u.multiFaceLandmarks)drawConnectors(v,e,FACEMESH_LIPS,{color:"#E0E0E0"});if(u.multiFaceLandmarks&&0<u.multiFaceLandmarks.length){var n=u.multiFaceLandmarks[0];let e=1/0,t=1/0,a=-1/0,i=-1/0;for(const F of n){var d=F.x*w.width,o=F.y*w.height;e=Math.min(e,d),t=Math.min(t,o),a=Math.max(a,d),i=Math.max(i,o)}var r=a-e,c=r*(i-t)/(window.innerWidth*window.innerHeight),s=n[10],h=s.x*w.width,m=s.y*w.height,l=r+10*c;v.drawImage(f,h-l/2,m-l,l,l);var g=n[13],s=n[14],r=Math.abs(g.y-s.y);.05<r?($(".camera-text").addClass("hide"),x=x||!0):$(".camera-text").removeClass("hide"),x&&(c=(g.y+s.y)/2,h=n[61].x*w.width,m=n[291].x*w.width,g=(l=w.width-3*y)+y/2,n=(s=w.width-7*y)+y/2,C>w.height&&(C=-2*y),C+y/2>c*w.height&&h<g&&g<m&&.05<r&&(C=-2*y,F++),M>w.height&&(M=-4*y),M+y/2>c*w.height&&h<n&&n<m&&.05<r&&(M=-4*y,F++),$(".camera-direction").hide(),v.drawImage(p,l,C,y,y),C+=.1*y,v.drawImage(p,s,M,y,y),M+=.08*y)}$(".text").text(F),v.restore()})}),d=new Camera(a,{onFrame:async()=>{await c.send({image:a}),o=o||!0,o&&r&&$(".loading").addClass("hide")},width:a.videoWidth,height:a.videoHeight,facingMode:t}),d.start(),r=r||!0,o&&r&&$(".loading").addClass("hide")}).catch(function(e){alert("取得相機訪問權限失敗: ",e.message,e.name)})}c.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t("user"),$("[data-camera-direction]").off("click.direction").on("click.direction",function(){$(".loading").removeClass("hide"),n.getTracks().forEach(e=>e.stop()),d&&d.stop(),document.querySelector(".camera-video").innerHTML="",document.querySelector(".camera-screen").innerHTML="",o=!1,r=!1,e=!e,setTimeout(()=>{t(e?"user":"environment")},0)})});
//# sourceMappingURL=main.min.js.map
