$(function(){$(window).on("resize.vh",function(){var e=.01*window.innerHeight;$("html").css("--vh",e+"px")}).trigger("resize.vh");const y=new Image;y.src="./assets/image/touch/logo.png";const x=new Image;x.src="./assets/image/food.svg";let k=0,n,d,e=!0,r=!1,c=!1,C=!1,M=0;const o=new FaceMesh({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${e}`});function t(t){const a=document.createElement("video");a.setAttribute("playsinline",""),a.setAttribute("autoplay",""),a.setAttribute("muted",""),document.querySelector(".camera-video").appendChild(a);const f=document.createElement("canvas");document.querySelector(".camera-screen").appendChild(f);const p=f.getContext("2d");let i;navigator.mediaDevices.getUserMedia({video:{facingMode:t,width:{ideal:2400},height:{ideal:3200}}}).then(async function(e){n=e,a.srcObject=e,i&&a.removeEventListener("loadeddata",i);new Promise((e,t)=>{i=function(){f.width=a.videoWidth,f.height=a.videoHeight,k=.15*f.width,e()},a.addEventListener("loadeddata",i,!1)});await 0;let w=-1*k,v=-5*k;o.onResults(function(u){requestAnimationFrame(()=>{if(p.clearRect(0,0,f.width,f.height),p.save(),"user"===t&&(p.translate(f.width,0),p.scale(-1,1)),p.drawImage(u.image,0,0,f.width,f.height),u.multiFaceLandmarks&&0<u.multiFaceLandmarks.length){var n=u.multiFaceLandmarks[0];let e=1/0,t=1/0,a=-1/0,i=-1/0;for(const M of n){var d=M.x*f.width,r=M.y*f.height;e=Math.min(e,d),t=Math.min(t,r),a=Math.max(a,d),i=Math.max(i,r)}var c=a-e,o=c*(i-t)/(window.innerWidth*window.innerHeight),s=n[10],h=s.x*f.width,m=s.y*f.height,g=c+10*o;p.drawImage(y,h-g/2,m-g,g,g);var l=n[13],s=n[14],c=Math.abs(l.y-s.y);.05<c?($(".camera-text").addClass("hide"),C=C||!0):$(".camera-text").removeClass("hide"),C&&(o=(l.y+s.y)/2,h=n[61].x*f.width,m=n[291].x*f.width,l=(g=f.width-2*k)+k/2,n=(s=f.width-6*k)+k/2,w>f.height&&(w=-2*k),w+k/2>o*f.height&&h<l&&l<m&&.05<c&&(w=-2*k,M++),v>f.height&&(v=-4*k),v+k/2>o*f.height&&h<n&&n<m&&.05<c&&(v=-4*k,M++),$(".camera-direction").hide(),p.drawImage(x,g,w,k,k),w+=.1*k,p.drawImage(x,s,v,k,k),v+=.08*k)}$(".text").text(M),p.restore()})}),d=new Camera(a,{onFrame:async()=>{await o.send({image:a}),r=r||!0,r&&c&&$(".loading").addClass("hide")},width:a.videoWidth,height:a.videoHeight,facingMode:t}),d.start(),c=c||!0,r&&c&&$(".loading").addClass("hide")}).catch(function(e){alert("取得相機訪問權限失敗: ",e.message,e.name)}),$("[data-camera-taking]").off("click").on("click",function(){resultImg=f.toDataURL("image/jpeg",1),$("[data-pic]").attr("src",resultImg)})}o.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t("user"),$("[data-camera-direction]").off("click.direction").on("click.direction",function(){$(".loading").removeClass("hide"),n.getTracks().forEach(e=>e.stop()),d&&d.stop(),document.querySelector(".camera-video").innerHTML="",document.querySelector(".camera-screen").innerHTML="",r=!1,c=!1,e=!e,setTimeout(()=>{t(e?"user":"environment")},0)})});
//# sourceMappingURL=main.min.js.map
