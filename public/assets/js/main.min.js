$(function(){$(window).on("resize.vh",function(){var e=.01*window.innerHeight;$("html").css("--vh",e+"px")}).trigger("resize.vh");const y=new Image;y.src="./assets/image/touch/logo.png";const x=new Image;x.src="./assets/image/food.svg";let C=0,n,d,e=!0,r=!1,o=!1,M=!1,k=0;const c=new FaceMesh({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${e}`});function t(t){const i=document.createElement("video");i.setAttribute("playsinline",""),i.setAttribute("autoplay",""),i.setAttribute("muted",""),document.querySelector(".camera-video").appendChild(i);const f=document.createElement("canvas");document.querySelector(".camera-screen").appendChild(f);const p=f.getContext("2d");let a;navigator.mediaDevices.getUserMedia({video:{facingMode:t,width:{ideal:2400},height:{ideal:3200}}}).then(async function(e){n=e,i.srcObject=e,a&&i.removeEventListener("loadeddata",a);new Promise((e,t)=>{a=function(){f.width=i.videoWidth,f.height=i.videoHeight,C=.15*f.width,e()},i.addEventListener("loadeddata",a,!1)});await 0;let w=-1*C,v=-5*C;c.onResults(function(u){requestAnimationFrame(()=>{if(p.clearRect(0,0,f.width,f.height),p.save(),"user"===t&&(p.translate(f.width,0),p.scale(-1,1)),p.drawImage(u.image,0,0,f.width,f.height),u.multiFaceLandmarks&&0<u.multiFaceLandmarks.length){var n=u.multiFaceLandmarks[0];let e=1/0,t=1/0,i=-1/0,a=-1/0;for(const k of n){var d=k.x*f.width,r=k.y*f.height;e=Math.min(e,d),t=Math.min(t,r),i=Math.max(i,d),a=Math.max(a,r)}var o=i-e,c=o*(a-t)/(window.innerWidth*window.innerHeight),s=n[10],h=s.x*f.width,m=s.y*f.height,l=o+10*c;p.drawImage(y,h-l/2,m-l,l,l);var g=n[13],s=n[14],o=Math.abs(g.y-s.y);.05<o?($(".camera-text").addClass("hide"),M=M||!0):$(".camera-text").removeClass("hide"),M&&(c=(g.y+s.y)/2,h=n[61].x*f.width,m=n[291].x*f.width,g=(l=f.width-3*C)+C/2,n=(s=f.width-7*C)+C/2,w>f.height&&(w=-2*C),w+C/2>c*f.height&&h<g&&g<m&&.05<o&&(w=-2*C,k++),v>f.height&&(v=-4*C),v+C/2>c*f.height&&h<n&&n<m&&.05<o&&(v=-4*C,k++),$(".camera-direction").hide(),p.drawImage(x,l,w,C,C),w+=.1*C,p.drawImage(x,s,v,C,C),v+=.08*C)}$(".text").text(k),p.restore()})}),d=new Camera(i,{onFrame:async()=>{await c.send({image:i}),r=r||!0,r&&o&&$(".loading").addClass("hide")},width:i.videoWidth,height:i.videoHeight,facingMode:t}),d.start(),o=o||!0,r&&o&&$(".loading").addClass("hide")}).catch(function(e){alert("取得相機訪問權限失敗: ",e.message,e.name)})}c.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t("user"),$("[data-camera-direction]").off("click.direction").on("click.direction",function(){$(".loading").removeClass("hide"),n.getTracks().forEach(e=>e.stop()),d&&d.stop(),document.querySelector(".camera-video").innerHTML="",document.querySelector(".camera-screen").innerHTML="",r=!1,o=!1,e=!e,setTimeout(()=>{t(e?"user":"environment")},0)})});
//# sourceMappingURL=main.min.js.map
