$(function(){$(window).on("resize.vh",function(){var e=.01*window.innerHeight;$("html").css("--vh",e+"px")}).trigger("resize.vh");!function i(p){console.log(p);let n;let o;const d=document.querySelector(`[data-camera-video="${p}"]`);const F=document.querySelector(`[data-camera-canvas="${p}"]`);const k=F.getContext("2d");let r;let c=!1;let s=!1;navigator.mediaDevices.getUserMedia({video:{facingMode:p,width:{ideal:2400},height:{ideal:3200}}}).then(async function(e){n=e,d.srcObject=e,r&&d.removeEventListener("loadeddata",r);var e=new Promise((e,a)=>{r=function(){F.width=d.videoWidth,F.height=d.videoHeight,e()},d.addEventListener("loadeddata",r,!1)});await e;const v=new Image;v.src="./assets/image/touch/logo.png";const a=new FaceMesh({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${e}`});function t(f){requestAnimationFrame(()=>{if(k.clearRect(0,0,F.width,F.height),k.save(),"user"===p&&(k.translate(F.width,0),k.scale(-1,1)),k.drawImage(f.image,0,0,F.width,F.height),f.multiFaceLandmarks)for(const e of f.multiFaceLandmarks)drawConnectors(k,e,FACEMESH_LIPS,{color:"#E0E0E0"});if(f.multiFaceLandmarks&&0<f.multiFaceLandmarks.length){var n=f.multiFaceLandmarks[0];let e=1/0,a=1/0,t=-1/0,i=-1/0;for(const w of n){var o=w.x*F.width,d=w.y*F.height;e=Math.min(e,o),a=Math.min(a,d),t=Math.max(t,o),i=Math.max(i,d)}var r=t-e,c=i-a,s=r*c,h=s/(window.innerWidth*window.innerHeight),m=n[10],l=m.x*F.width,g=m.y*F.height,u=r+10*h;k.drawImage(v,l-u/2,g-u,u,u)}k.restore()})}a.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),a.onResults(t),o=new Camera(d,{onFrame:async()=>{await a.send({image:d}),c||(c=!0,$(".text").append("<br>frameReady")),c&&s&&$(".loading").addClass("hide")},width:d.videoWidth,height:d.videoHeight,facingMode:p}),o.start(),s||(s=!0,$(".text").append("<br>cameraStart")),c&&s&&$(".loading").addClass("hide"),$(`[data-camera-direction="${p}"]`).off("click.direction").on("click.direction",function(){$(".loading").removeClass("hide"),n.getTracks().forEach(e=>e.stop()),o&&o.stop(),console.log(p),i("user"===p?"environment":"user")})}).catch(function(e){alert("取得相機訪問權限失敗: ",e.message,e.name)})}("user")});
//# sourceMappingURL=main.min.js.map
