$(function(){$(window).on("resize.vh",function(){var e=.01*window.innerHeight;$("html").css("--vh",e+"px")}).trigger("resize.vh");const g=new Image;g.src="./assets/image/touch/logo.png";let n,o,e=!0,d=!1,r=!1;const c=new FaceMesh({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${e}`});function t(t){const i=document.createElement("video");i.setAttribute("playsinline",""),i.setAttribute("autoplay",""),i.setAttribute("muted",""),document.querySelector(".camera-video").appendChild(i);const l=document.createElement("canvas");document.querySelector(".camera-screen").appendChild(l);const u=l.getContext("2d");let a;navigator.mediaDevices.getUserMedia({video:{facingMode:t,width:{ideal:2400},height:{ideal:3200}}}).then(async function(e){n=e,i.srcObject=e,a&&i.removeEventListener("loadeddata",a);new Promise((e,t)=>{a=function(){l.width=i.videoWidth,l.height=i.videoHeight,e()},i.addEventListener("loadeddata",a,!1)});await 0,c.onResults(function(h){requestAnimationFrame(()=>{if(u.clearRect(0,0,l.width,l.height),u.save(),"user"===t&&(u.translate(l.width,0),u.scale(-1,1)),u.drawImage(h.image,0,0,l.width,l.height),h.multiFaceLandmarks)for(const e of h.multiFaceLandmarks)drawConnectors(u,e,FACEMESH_LIPS,{color:"#E0E0E0"});if(h.multiFaceLandmarks&&0<h.multiFaceLandmarks.length){var n=h.multiFaceLandmarks[0];let e=1/0,t=1/0,i=-1/0,a=-1/0;for(const m of n){var o=m.x*l.width,d=m.y*l.height;e=Math.min(e,o),t=Math.min(t,d),i=Math.max(i,o),a=Math.max(a,d)}var r=i-e,c=r*(a-t)/(window.innerWidth*window.innerHeight),s=n[10],n=s.x*l.width,s=s.y*l.height,c=r+10*c;u.drawImage(g,n-c/2,s-c,c,c)}u.restore()})}),o=new Camera(i,{onFrame:async()=>{await c.send({image:i}),d=d||!0,d&&r&&$(".loading").addClass("hide")},width:i.videoWidth,height:i.videoHeight,facingMode:t}),o.start(),r=r||!0,d&&r&&$(".loading").addClass("hide")}).catch(function(e){alert("取得相機訪問權限失敗: ",e.message,e.name)})}c.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t("user"),$("[data-camera-direction]").off("click.direction").on("click.direction",function(){$(".loading").removeClass("hide"),n.getTracks().forEach(e=>e.stop()),o&&o.stop(),document.querySelector(".camera-video").innerHTML="",document.querySelector(".camera-screen").innerHTML="",d=!1,r=!1,e=!e,setTimeout(()=>{t(e?"user":"environment")},0)})});
//# sourceMappingURL=main.min.js.map
